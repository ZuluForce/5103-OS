\hypertarget{classcBlockDevice}{\section{c\-Block\-Device \-Class \-Reference}
\label{dd/d36/classcBlockDevice}\index{c\-Block\-Device@{c\-Block\-Device}}
}


\-Queued block device.  




{\ttfamily \#include $<$block\-\_\-device.\-h$>$}



\-Inheritance diagram for c\-Block\-Device\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=184pt]{d2/d52/classcBlockDevice__inherit__graph}
\end{center}
\end{figure}


\-Collaboration diagram for c\-Block\-Device\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=342pt]{d1/dd3/classcBlockDevice__coll__graph}
\end{center}
\end{figure}
\subsection*{\-Public \-Member \-Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classcBlockDevice_a640cb07a008538d19d6d39696b175e09}{{\bfseries c\-Block\-Device} (int usec)}\label{dd/d36/classcBlockDevice_a640cb07a008538d19d6d39696b175e09}

\item 
void \hyperlink{classcBlockDevice_ab6daadb251c1c59aca70bdc1f73fcb62}{set\-Default\-Time} (int usec)
\begin{DoxyCompactList}\small\item\em \-Set the default timer length for this device. \end{DoxyCompactList}\item 
void \hyperlink{classcBlockDevice_a2b1bae22bb9474fb140faefc1bed6525}{schedule\-Device} (\hyperlink{structProcessInfo}{\-Process\-Info} $\ast$)
\begin{DoxyCompactList}\small\item\em \-Schedule a process for a device interrupt. \end{DoxyCompactList}\item 
\hyperlink{structProcessInfo}{\-Process\-Info} $\ast$ \hyperlink{classcBlockDevice_a65f11097ece15c840c15aa7e6086d94d}{timer\-Finished} ()
\begin{DoxyCompactList}\small\item\em \-Called when a device timer has gone off. \end{DoxyCompactList}\item 
\hypertarget{classcBlockDevice_a94ce11ed6420b152ad1cec5648262a78}{int \hyperlink{classcBlockDevice_a94ce11ed6420b152ad1cec5648262a78}{queue\-Length} ()}\label{dd/d36/classcBlockDevice_a94ce11ed6420b152ad1cec5648262a78}

\begin{DoxyCompactList}\small\item\em \-Returns the number of devices waiting on the device. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{\-Private \-Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classcBlockDevice_a974100450cc04f4b2ab8fbf419b51f2d}{queue$<$ \hyperlink{structProcessInfo}{\-Process\-Info} $\ast$ $>$ {\bfseries wait\-Queue}}\label{dd/d36/classcBlockDevice_a974100450cc04f4b2ab8fbf419b51f2d}

\item 
\hypertarget{classcBlockDevice_a6682a95bc2a71aeaa6a9ce75f07b0fa6}{pthread\-\_\-mutex\-\_\-t {\bfseries device\-Lock}}\label{dd/d36/classcBlockDevice_a6682a95bc2a71aeaa6a9ce75f07b0fa6}

\end{DoxyCompactItemize}


\subsection{\-Member \-Function \-Documentation}
\hypertarget{classcBlockDevice_a2b1bae22bb9474fb140faefc1bed6525}{\index{c\-Block\-Device@{c\-Block\-Device}!schedule\-Device@{schedule\-Device}}
\index{schedule\-Device@{schedule\-Device}!cBlockDevice@{c\-Block\-Device}}
\subsubsection[{schedule\-Device}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf c\-Block\-Device\-::schedule\-Device} (
\begin{DoxyParamCaption}
\item[{{\bf \-Process\-Info} $\ast$}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}\label{dd/d36/classcBlockDevice_a2b1bae22bb9474fb140faefc1bed6525}
\-If there are no other waiting processes then schedule the interrupt. \-If there is a pending interrupt then queue the process.


\begin{DoxyParams}{\-Parameters}
{\em \-Process\-Info$\ast$} & \-Process that wants to block on the device. \-This must be saved and returned to the kernel when its interrupt has been received.\\
\hline
\end{DoxyParams}
\begin{DoxyWarning}{\-Warning}
\-This must be synchronized with \hyperlink{classcBlockDevice_a65f11097ece15c840c15aa7e6086d94d}{timer\-Finished} because signal handlers will cause these methods to be called asynchronously. 
\end{DoxyWarning}


\-Implements \hyperlink{classcAbsQueuedDevice_a529f1c7576d9ec9b87c1d2eb6758c215}{c\-Abs\-Queued\-Device}.



\-Referenced by c\-Kernel\-::boot().

\hypertarget{classcBlockDevice_ab6daadb251c1c59aca70bdc1f73fcb62}{\index{c\-Block\-Device@{c\-Block\-Device}!set\-Default\-Time@{set\-Default\-Time}}
\index{set\-Default\-Time@{set\-Default\-Time}!cBlockDevice@{c\-Block\-Device}}
\subsubsection[{set\-Default\-Time}]{\setlength{\rightskip}{0pt plus 5cm}void {\bf c\-Block\-Device\-::set\-Default\-Time} (
\begin{DoxyParamCaption}
\item[{int}]{usec}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}\label{dd/d36/classcBlockDevice_ab6daadb251c1c59aca70bdc1f73fcb62}
\-Subsequent calls to schedule the device for a process should use this default time. \-This is convenience function. \-A class defined default can be defined statically or in the constructor.


\begin{DoxyParams}{\-Parameters}
{\em int} & usec default microsecond length for device timer. \\
\hline
\end{DoxyParams}


\-Implements \hyperlink{classcAbsQueuedDevice_a57ab7f649c2c40034212627b78476908}{c\-Abs\-Queued\-Device}.

\hypertarget{classcBlockDevice_a65f11097ece15c840c15aa7e6086d94d}{\index{c\-Block\-Device@{c\-Block\-Device}!timer\-Finished@{timer\-Finished}}
\index{timer\-Finished@{timer\-Finished}!cBlockDevice@{c\-Block\-Device}}
\subsubsection[{timer\-Finished}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Process\-Info} $\ast$ {\bf c\-Block\-Device\-::timer\-Finished} (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}\label{dd/d36/classcBlockDevice_a65f11097ece15c840c15aa7e6086d94d}
\-The signal handler in the kernel will call this method when a device's timer has completed. \-The method should then return the waiting process and then schedule an interrupt for the next device queued, if any.

\begin{DoxyReturn}{\-Returns}
\-Process\-Info$\ast$ \-Process that was waiting for the device \-I/\-O to complete. \-It will now be unblocked by the kernel/scheduler.
\end{DoxyReturn}
\begin{DoxyWarning}{\-Warning}
\-Must be synchronized with \hyperlink{classcBlockDevice_a2b1bae22bb9474fb140faefc1bed6525}{schedule\-Device}. \-Failing to do so could leave a process blocked indefinitely. 
\end{DoxyWarning}


\-Implements \hyperlink{classcAbsQueuedDevice_a98e8fefe9ef8823c854c6769ab1bef55}{c\-Abs\-Queued\-Device}.



\-The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
include/devices/\hyperlink{block__device_8h}{block\-\_\-device.\-h}\item 
src/devices/block\-\_\-device.\-cpp\end{DoxyCompactItemize}
